---
kind: pipeline
name: ServerCore 1809 Images

platform:
  os: windows
  arch: amd64
  version: 1809

steps:
- name: build-base
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1809
    context: base
    daemon_off: true
    dockerfile: base/Dockerfile.1809
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/base
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scripts
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1809
    build_args:
    - IMAGE_TAG=1809
    context: scripts
    daemon_off: true
    dockerfile: scripts/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scripts
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scm
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1809
    build_args:
    - IMAGE_TAG=1809
    context: scm
    daemon_off: true
    dockerfile: scm/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scm
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-tools
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1809
    build_args:
    - IMAGE_TAG=1809
    context: tools
    daemon_off: true
    dockerfile: tools/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/tools
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1809
    build_args:
    - IMAGE_TAG=1809
    context: msbuild
    daemon_off: true
    dockerfile: msbuild/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild-2017
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1809
    build_args:
    - IMAGE_TAG=1809
    context: msbuild-2017
    daemon_off: true
    dockerfile: msbuild-2017/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild-2017
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-buildbot
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1809
    build_args:
    - IMAGE_TAG=1809
    context: buildbot
    daemon_off: true
    dockerfile: buildbot/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/buildbot
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-ews
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1809
    build_args:
    - IMAGE_TAG=1809
    context: ews
    daemon_off: true
    dockerfile: ews/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/ews
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

volumes:
- name: docker_pipe
  host:
    path: \\\\.\\pipe\\docker_engine

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

---
kind: pipeline
name: ServerCore 1903 Images

platform:
  os: windows
  arch: amd64
  version: 1903

steps:
- name: build-base
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1903
    context: base
    daemon_off: true
    dockerfile: base/Dockerfile.1903
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/base
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scripts
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1903
    build_args:
    - IMAGE_TAG=1903
    context: scripts
    daemon_off: true
    dockerfile: scripts/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scripts
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scm
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1903
    build_args:
    - IMAGE_TAG=1903
    context: scm
    daemon_off: true
    dockerfile: scm/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scm
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-tools
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1903
    build_args:
    - IMAGE_TAG=1903
    context: tools
    daemon_off: true
    dockerfile: tools/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/tools
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1903
    build_args:
    - IMAGE_TAG=1903
    context: msbuild
    daemon_off: true
    dockerfile: msbuild/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild-2017
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1903
    build_args:
    - IMAGE_TAG=1903
    context: msbuild-2017
    daemon_off: true
    dockerfile: msbuild-2017/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild-2017
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-buildbot
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1903
    build_args:
    - IMAGE_TAG=1903
    context: buildbot
    daemon_off: true
    dockerfile: buildbot/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/buildbot
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-ews
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1903
    build_args:
    - IMAGE_TAG=1903
    context: ews
    daemon_off: true
    dockerfile: ews/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/ews
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

volumes:
- name: docker_pipe
  host:
    path: \\\\.\\pipe\\docker_engine

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

---
kind: pipeline
name: ServerCore 1909 Images

platform:
  os: windows
  arch: amd64
  version: 1909

steps:
- name: build-base
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1909
    context: base
    daemon_off: true
    dockerfile: base/Dockerfile.1909
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/base
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scripts
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1909
    build_args:
    - IMAGE_TAG=1909
    context: scripts
    daemon_off: true
    dockerfile: scripts/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scripts
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scm
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1909
    build_args:
    - IMAGE_TAG=1909
    context: scm
    daemon_off: true
    dockerfile: scm/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scm
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-tools
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1909
    build_args:
    - IMAGE_TAG=1909
    context: tools
    daemon_off: true
    dockerfile: tools/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/tools
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1909
    build_args:
    - IMAGE_TAG=1909
    context: msbuild
    daemon_off: true
    dockerfile: msbuild/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild-2017
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1909
    build_args:
    - IMAGE_TAG=1909
    context: msbuild-2017
    daemon_off: true
    dockerfile: msbuild-2017/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild-2017
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-buildbot
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1909
    build_args:
    - IMAGE_TAG=1909
    context: buildbot
    daemon_off: true
    dockerfile: buildbot/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/buildbot
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-ews
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 1909
    build_args:
    - IMAGE_TAG=1909
    context: ews
    daemon_off: true
    dockerfile: ews/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/ews
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

volumes:
- name: docker_pipe
  host:
    path: \\\\.\\pipe\\docker_engine

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

---
kind: pipeline
name: ServerCore 2004 Images

platform:
  os: windows
  arch: amd64
  version: 2004

steps:
- name: build-base
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 2004
    context: base
    daemon_off: true
    dockerfile: base/Dockerfile.2004
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/base
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scripts
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 2004
    build_args:
    - IMAGE_TAG=2004
    context: scripts
    daemon_off: true
    dockerfile: scripts/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scripts
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scm
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 2004
    build_args:
    - IMAGE_TAG=2004
    context: scm
    daemon_off: true
    dockerfile: scm/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scm
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-tools
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 2004
    build_args:
    - IMAGE_TAG=2004
    context: tools
    daemon_off: true
    dockerfile: tools/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/tools
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 2004
    build_args:
    - IMAGE_TAG=2004
    context: msbuild
    daemon_off: true
    dockerfile: msbuild/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild-2017
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 2004
    build_args:
    - IMAGE_TAG=2004
    context: msbuild-2017
    daemon_off: true
    dockerfile: msbuild-2017/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild-2017
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-buildbot
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 2004
    build_args:
    - IMAGE_TAG=2004
    context: buildbot
    daemon_off: true
    dockerfile: buildbot/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/buildbot
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-ews
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: 2004
    build_args:
    - IMAGE_TAG=2004
    context: ews
    daemon_off: true
    dockerfile: ews/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/ews
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

volumes:
- name: docker_pipe
  host:
    path: \\\\.\\pipe\\docker_engine

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

---
kind: pipeline
name: Windows 1809 Images

platform:
  os: windows
  arch: amd64
  version: 1809

steps:
- name: build-base
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1809
    context: base
    daemon_off: true
    dockerfile: base/Dockerfile.windows-1809
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/base
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scripts
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1809
    build_args:
    - IMAGE_TAG=windows-1809
    context: scripts
    daemon_off: true
    dockerfile: scripts/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scripts
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scm
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1809
    build_args:
    - IMAGE_TAG=windows-1809
    context: scm
    daemon_off: true
    dockerfile: scm/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scm
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-tools
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1809
    build_args:
    - IMAGE_TAG=windows-1809
    context: tools
    daemon_off: true
    dockerfile: tools/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/tools
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1809
    build_args:
    - IMAGE_TAG=windows-1809
    context: msbuild
    daemon_off: true
    dockerfile: msbuild/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild-2017
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1809
    build_args:
    - IMAGE_TAG=windows-1809
    context: msbuild-2017
    daemon_off: true
    dockerfile: msbuild-2017/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild-2017
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-buildbot
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1809
    build_args:
    - IMAGE_TAG=windows-1809
    context: buildbot
    daemon_off: true
    dockerfile: buildbot/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/buildbot
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-ews
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1809
    build_args:
    - IMAGE_TAG=windows-1809
    context: ews
    daemon_off: true
    dockerfile: ews/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/ews
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

volumes:
- name: docker_pipe
  host:
    path: \\\\.\\pipe\\docker_engine

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

---
kind: pipeline
name: Windows 1903 Images

platform:
  os: windows
  arch: amd64
  version: 1903

steps:
- name: build-base
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1903
    context: base
    daemon_off: true
    dockerfile: base/Dockerfile.windows-1903
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/base
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scripts
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1903
    build_args:
    - IMAGE_TAG=windows-1903
    context: scripts
    daemon_off: true
    dockerfile: scripts/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scripts
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scm
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1903
    build_args:
    - IMAGE_TAG=windows-1903
    context: scm
    daemon_off: true
    dockerfile: scm/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scm
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-tools
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1903
    build_args:
    - IMAGE_TAG=windows-1903
    context: tools
    daemon_off: true
    dockerfile: tools/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/tools
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1903
    build_args:
    - IMAGE_TAG=windows-1903
    context: msbuild
    daemon_off: true
    dockerfile: msbuild/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild-2017
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1903
    build_args:
    - IMAGE_TAG=windows-1903
    context: msbuild-2017
    daemon_off: true
    dockerfile: msbuild-2017/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild-2017
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-buildbot
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1903
    build_args:
    - IMAGE_TAG=windows-1903
    context: buildbot
    daemon_off: true
    dockerfile: buildbot/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/buildbot
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-ews
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1903
    build_args:
    - IMAGE_TAG=windows-1903
    context: ews
    daemon_off: true
    dockerfile: ews/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/ews
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

volumes:
- name: docker_pipe
  host:
    path: \\\\.\\pipe\\docker_engine

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

---
kind: pipeline
name: Windows 1909 Images

platform:
  os: windows
  arch: amd64
  version: 1909

steps:
- name: build-base
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1909
    context: base
    daemon_off: true
    dockerfile: base/Dockerfile.windows-1909
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/base
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scripts
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1909
    build_args:
    - IMAGE_TAG=windows-1909
    context: scripts
    daemon_off: true
    dockerfile: scripts/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scripts
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scm
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1909
    build_args:
    - IMAGE_TAG=windows-1909
    context: scm
    daemon_off: true
    dockerfile: scm/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scm
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-tools
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1909
    build_args:
    - IMAGE_TAG=windows-1909
    context: tools
    daemon_off: true
    dockerfile: tools/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/tools
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1909
    build_args:
    - IMAGE_TAG=windows-1909
    context: msbuild
    daemon_off: true
    dockerfile: msbuild/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild-2017
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1909
    build_args:
    - IMAGE_TAG=windows-1909
    context: msbuild-2017
    daemon_off: true
    dockerfile: msbuild-2017/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild-2017
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-buildbot
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1909
    build_args:
    - IMAGE_TAG=windows-1909
    context: buildbot
    daemon_off: true
    dockerfile: buildbot/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/buildbot
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-ews
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-1909
    build_args:
    - IMAGE_TAG=windows-1909
    context: ews
    daemon_off: true
    dockerfile: ews/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/ews
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

volumes:
- name: docker_pipe
  host:
    path: \\\\.\\pipe\\docker_engine

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

---
kind: pipeline
name: Windows 2004 Images

platform:
  os: windows
  arch: amd64
  version: 2004

steps:
- name: build-base
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-2004
    context: base
    daemon_off: true
    dockerfile: base/Dockerfile.windows-2004
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/base
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scripts
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-2004
    build_args:
    - IMAGE_TAG=windows-2004
    context: scripts
    daemon_off: true
    dockerfile: scripts/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scripts
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-scm
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-2004
    build_args:
    - IMAGE_TAG=windows-2004
    context: scm
    daemon_off: true
    dockerfile: scm/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/scm
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-tools
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-2004
    build_args:
    - IMAGE_TAG=windows-2004
    context: tools
    daemon_off: true
    dockerfile: tools/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/tools
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-2004
    build_args:
    - IMAGE_TAG=windows-2004
    context: msbuild
    daemon_off: true
    dockerfile: msbuild/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-msbuild-2017
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-2004
    build_args:
    - IMAGE_TAG=windows-2004
    context: msbuild-2017
    daemon_off: true
    dockerfile: msbuild-2017/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/msbuild-2017
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-buildbot
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-2004
    build_args:
    - IMAGE_TAG=windows-2004
    context: buildbot
    daemon_off: true
    dockerfile: buildbot/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/buildbot
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

- name: build-ews
  pull: always
  image: plugins/docker
  settings:
    auto_tag: true
    auto_tag_suffix: windows-2004
    build_args:
    - IMAGE_TAG=windows-2004
    context: ews
    daemon_off: true
    dockerfile: ews/Dockerfile
    password:
      from_secret: docker_password
    purge: false
    repo: webkitdev/ews
    username:
      from_secret: docker_username
  volumes:
  - name: docker_pipe
    path: \\\\.\\pipe\\docker_engine

volumes:
- name: docker_pipe
  host:
    path: \\\\.\\pipe\\docker_engine

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

---
kind: pipeline
name: Image Manifest

platform:
  os: windows
  arch: amd64
  version: 1809

steps:
- name: publish-manifest-base
  pull: always
  image: plugins/manifest
  settings:
    ignore_missing: true
    password:
      from_secret: docker_password
    spec: base/manifest.tmpl
    username:
      from_secret: docker_username

- name: publish-manifest-scripts
  pull: always
  image: plugins/manifest
  settings:
    ignore_missing: true
    password:
      from_secret: docker_password
    spec: scripts/manifest.tmpl
    username:
      from_secret: docker_username

- name: publish-manifest-scm
  pull: always
  image: plugins/manifest
  settings:
    ignore_missing: true
    password:
      from_secret: docker_password
    spec: scm/manifest.tmpl
    username:
      from_secret: docker_username

- name: publish-manifest-tools
  pull: always
  image: plugins/manifest
  settings:
    ignore_missing: true
    password:
      from_secret: docker_password
    spec: tools/manifest.tmpl
    username:
      from_secret: docker_username

- name: publish-manifest-msbuild
  pull: always
  image: plugins/manifest
  settings:
    ignore_missing: true
    password:
      from_secret: docker_password
    spec: msbuild/manifest.tmpl
    username:
      from_secret: docker_username

- name: publish-manifest-msbuild-2017
  pull: always
  image: plugins/manifest
  settings:
    ignore_missing: true
    password:
      from_secret: docker_password
    spec: msbuild-2017/manifest.tmpl
    username:
      from_secret: docker_username

- name: publish-manifest-buildbot
  pull: always
  image: plugins/manifest
  settings:
    ignore_missing: true
    password:
      from_secret: docker_password
    spec: buildbot/manifest.tmpl
    username:
      from_secret: docker_username

- name: publish-manifest-ews
  pull: always
  image: plugins/manifest
  settings:
    ignore_missing: true
    password:
      from_secret: docker_password
    spec: ews/manifest.tmpl
    username:
      from_secret: docker_username

trigger:
  ref:
  - refs/heads/**
  - refs/tags/**

depends_on:
- ServerCore 1809 Images
- ServerCore 1903 Images
- ServerCore 1909 Images
- ServerCore 2004 Images
- Windows 1809 Images
- Windows 1903 Images
- Windows 1909 Images
- Windows 2004 Images

...
